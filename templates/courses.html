<!-- courses.html -->
{% extends 'base_dash.html' %}
{% block title %}Available Courses | Eduverse{% endblock %}

{% block content %}
<main class="dashboard-card">
  <h2 id="courses-title" class="card-title">Available Courses</h2>

  {% if courses %}
  <div class="course-grid" role="list">
    {% for course in courses %}
    <article class="course-card" role="listitem">
      <h3 class="course-title">{{ course.title }}</h3>

      {% if course.image_path %}
      <img src="{{ url_for('static', filename=course.image_path) }}"
           alt="{{ course.title }} thumbnail"
           class="course-thumbnail">
      {% else %}
      <div class="course-thumbnail placeholder" aria-hidden="true">No Image</div>
      {% endif %}

      <p class="card-text">{{ course.description }}</p>

      {% if course.id in enrolled_milestones %}
        {% set milestones = enrolled_milestones[course.id] %}
        {% set topic_count = topics[course.id] | length %}
        {% set total_milestones = 1 + topic_count %}
        {% set progress = ((milestones | length) / total_milestones * 100) | round(0) %}

        <div class="course-progress">Progress: {{ progress }}%</div>
        <a href="{{ url_for('course_detail', course_id=course.id) }}" class="btn btn-primary">Continue</a>
      {% else %}
        <a href="{{ url_for('enroll', course_id=course.id) }}" class="btn btn-primary">Enroll</a>
      {% endif %}
    </article>
    {% endfor %}
  </div>
  {% else %}
    <p>No courses are currently available. Check back later!</p>
  {% endif %}
</main>
{% endblock %}
